<!DOCTYPE html>
<meta charset="utf-8">
<title>animas</title>
<head >

  <style>
    body { margin:0;position:fixed;top:0;right:0;bottom:0;left:0; }
    div#fps,svg { position: fixed; top:0; left:0; color: white; }
  </style>

</head>
<body style="cursor:crosshair"></body>
<div id="viewframe" class="viewframe"></div>

<script src="elem-enls.js"></script>
<script src="elem-ents.js"></script>

<script>

let __mapper = muonMapper.muonMapper()
let xxs = __mapper({'xs': xs.xs(__mapper)}).xs  // register and assign proxy

let mstorePromise = 	__mapper('xs').m('store')
let banimationPromise = 	__mapper('xs').b('animation')

animasPromise(__mapper)
  .then(function(animas){
      xxs.m('store').apply({type: 'UPDANIMA', animas: animas})
  })

__mapper({'bosonAnimation': bosonAnimation.bosonAnimation(__mapper)})


async function animasPromise(__mapper) {

  let rrenderportPromise = __mapper('xs').r('renderport'),
    propsPromise = __mapper('xs').m('props'),
    cwenPromise = __mapper('xs').c('wen'),
    mnatPromise = __mapper('xs').m('nat')
    
  let [rrenderport, f, cwen, mnat] 
      = await Promise.all([rrenderportPromise, propsPromise, cwenPromise, mnatPromise])
  
  let width = rrenderport.width(),
    height = rrenderport.height(),
    scaleProj = Math.min(width / 2, height) / Math.PI

  let radians = Math.PI / 180, degrees = 180 / Math.PI,
    sin = Math.sin, cos = Math.cos, sqrt = Math.sqrt


  let fact = n =>  n - 1 > 0 ? n * fact(n - 1) : n
  let fact0 = 1,
        fact1 = 1,
           fact2 = 2,
            fact3 = 6,
             fact4 = 24,
              fact5 = 120,
               fact6 = 720,
                fact7 = 5040,
                 fact8 = 40320,
                  fact9 = 362880
  let infact0 = 1/fact0,
        infact1 = 1/fact1,
           infact2 = 1/fact2,
            infact3 = 1/fact3,
             infact4 = 1/fact4,
              infact5 = 1/fact5,
               infact6 = 1/fact6,
                infact7 = 1/fact7
                 infact8 = 1/fact8
                  infact9 = 1/fact9


    let sinp = [infact0,0,-infact2,0,infact4,0,-infact6,0,infact8]
    let cosp = [0,infact1,0,-infact3,0,infact5,0,-infact7,0,infact9]
    let exp = [infact0,infact1,infact2,infact3,infact4,infact5,infact6,infact7,infact8,infact9]
    

        
        // ............................. pics
        let tim = {'td': 9600, 't0': 0, 't1': 1000, 't2': 1, 't3': 1, nostop:1, tf: t => t}


        let conform = {
          'x': {
            'm1': 4, 'm2': 4, 'n1': 2, 'n2': 2, 'n3': 2, 'a': 1, 'b': 1,  // circ
            'ra2': 120,'v0': 0,'v1': 1,'w4': 0 ,'seg5': 180,'pa6': 0,'pb7': -1,
            'dom3': [-180, 180],
            c1:[1, 0], e1:[0, 1], // 1 * q 
            c4:[1 , 0 ], e4: [1, 0, -infact2, 0, infact4, 0, -infact6, 0, infact8],  // 1 * cos(v)
            // 'fn0': (q,s, u=0,v=0, a,b, c=1,d=1) => q,
            
          },
          'y': {
            'm1': 4, 'm2': 4, 'n1': 2, 'n2': 2, 'n3': 2, 'a': 1, 'b': 1,  // circ
            'ra2': 120,'v0': 0,'v1': 1,'w4': 0 ,'seg5': 180,'pa6': 0,'pb7': -1,
            'dom3': [-180, 180],
            // c1:[1, 0], e1: [infact0,infact1,infact2,infact3,infact4,infact5,infact6,infact7,infact8,infact9],  // 1 * exp(q)
            // c1:[1 , 0 ], e1: [infact0, 0, -infact2, 0, infact4, 0, -infact6, 0, infact8],  // 1 * cos(v)            
            // c4:[1, 0], e4:[0, infact1, 0, -infact3, 0, infact5, 0, -infact7, 0, infact9] // 1 * sin(v) 
            // 'fn0': (q,s, u=0,v=0, a,b, c=1,d=1) => sin( 10 * s),  // net
            // 'fn0': (q,s, u=0,v=0, a,b, c=1,d=1) => sin(s),  // net
            // 'fn0': (q,s, u=0,v=0, a,b, c=1,d=1) => cos( 10 * s),  // net
            'fn0': (q,s, u=0,v=0, a,b, c=1,d=1) => (1 / Math.exp( Math.abs(s/2))) *  cos(9 * s),  // net
            
          },

          'z': {
            'm1': 4, 'm2': 4, 'n1': 2, 'n2': 2, 'n3': 2, 'a': 1, 'b': 1,  // circ
            'ra2': 120,'v0': 0,'v1': 1,'w4': 0 ,'seg5': [[[18,36,18]]],'pa6': 0,'pb7': -1,
            'dom3': [-90, 90],
            c1:[1, 0], e1:[0,1], // 1 * q
            c4:[1, 0], e4:[0, 1, 0, -infact3, 0, infact5, 0, -infact7, 0, infact9] // 1 * sin(v) 
          },

          'r': {
            'm1': 4, 'm2': 4, 'n1': 2, 'n2': 2, 'n3': 2, 'a': 1, 'b': 1,  // circ
            'ra2': 120,'v0': 0,'v1': 1,'w4': 0 ,'seg5': [[[18,36,18]]],'pa6': 0,'pb7': -1,
            'dom3': [-90, 90],
            c1:[1, 0], e1:[1, 0, 0, 0, 0, 0, 0, 0, 0, 0],   // 1 * id(q)
            
          },

        }

        let boform = { 'csx': 0, 'cf': [[[266, 266, 266]]], 'co': [[[0.5, 0.5]]],
            'cs': [[[888, 666, 888]]], 'cw': [[[1.1, 1.1, 1.1]]], 'cp': [[[0.9, 0.9]]]}

        // ............................. natForm
        let natForm = {

          halo: 'nat',

          geofold: p => mnat.natFeature(p.payload.form), // geofold: p => mnat.closeFeature(mnat.natFeature(p.payload.form)),
          payload: {
            tim,

            ric: {gid: 'q', cid: 'q', fid: 'q'},

            proform: {

                projection: 'uniwen',
                // scale: [1, 1],
                // scale: [0.5, 0.5],
                scale: [ [[[0.5,1.5]]], [[[0.5,1.5]]] ],

                // projection:  d3.geoOrthographic(),
                // scale: 100,

                prerotate: [[[ cwen.rotation ]]],
                translate: [ [0, 0, 0] ],
                // rotate: [ [[[90 + 0, 90 + 0, 90 + 1 * 360, 90 + 1 * 360]]], 0, 0 ],
                rotate: [ 0, 0, 0 ],
                lens: [0, 1, Infinity],
              },

            boform: boform,

            form: conform,

          }

        }
        // .................. sceneForm
        let sceneForm = {

          halo: 'scene',
          payload: {

            tim: tim,

            ric: {gid: 'scene', cid: 'scene', fid: 'scene'},

            context: {svg: 1, versor: 0, wen: 1, webgl: 0, bck: 0}
          }

        }
        // ............................. animas
        let animas = [

          sceneForm, // h.scene
          natForm, // h.nat

        ]

        return animas


    // })
    

}


</script>
<body style="cursor:crosshair"></body>