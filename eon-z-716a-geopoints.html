<!DOCTYPE html>
<meta charset="utf-8">
<title>animas</title>
<head >

  <style>
    body { margin:0;position:fixed;top:0;right:0;bottom:0;left:0; }
    div#fps,svg { position: fixed; top:0; left:0; color: white; }
  </style>

</head>
<body style="cursor:crosshair"></body>

<script src="eon-x-d3-require.js"></script>
<script src="eon-x-mapper.js"></script>
<script src="eon-x-s.js"></script>

<script>

;(async function eon () {
  let __mapper = xMapper.xMapper() // init mapper
  __mapper({'xD3Require': xD3Require}) // map require
  __mapper({'xs': xs.xs(__mapper)}) // map x.s

  let muonStore = await __mapper('xs').m('store') // map store
  let muonAnimation = await __mapper('xs').m('animation') // map animation

  let xanimas = await zindex(__mapper)
  let animas = xanimas.animas() // get animas

  muonStore.apply({type: 'UPDANIMA', animas: animas}) // upd animas
  muonAnimation.animate() // animate
})()

// .................. zindex
async function zindex (__mapper) {
  // .................. eons
  let [
    mprops,
    cwen,
    msnap,
    mlacer,
  ] = await Promise.all([
    __mapper('xs').m('props'),
    __mapper('xs').c('wen'),
    __mapper('xs').m('snap'),
    __mapper('xs').m('lacer'),
  ])

  // .................. animas
  let animas = function () {
    // .................. pics
    let tim = {'td': 3800, 't0': 0, 't1': 1000, 't2': 1, 't3': 1}
    let boform = { csx: 0, cf: 777, cs: 222, cw: 1.7, co: 0.7, cp: 0.5}
    let geofold = {type: 'Feature', geometry: { type: 'Point', coordinates: [0, 0]}, properties: {pointRadius: 6}}

    let translate = {'m1': 4,
      'm2': 4, 'n1': 2, 'n2': 2, 'n3': 2, 'a': 1, 'b': 1, // circle
      'ra2': 100, 'v0': 0, 'v1': 1, 'w4': 90, 'seg5': 360, 'pa6': 0, 'pb7': -1,
    }
    let proform = {projection: 'uniwen', scale: 1, translate: [ 0 - 300, 100 ], rotate: [ 0, 0 ],
      control: 'wen' }

    /*******************************************
 *    @animas
 */
    let p1 = {
      halo: 'ent',
      geofold,
      payload: {tim,
        boform,
        ric: {gid: 'p', cid: 'p', fid: 'p1'},
        proform: {projection: 'uniwen', scale: 1, rotate: [ 0, 0, 0 ], translate: [ [[[ 100 - 300, 125 ]]], 100 - 200, 0 ],
          control: 'wen' }},
    }

    let p2 = {
      halo: 'ent',
      geofold,
      payload: {tim,
        boform,
        ric: {gid: 'p', cid: 'p', fid: 'p2'},
        proform: {projection: 'uniwen', scale: 1, rotate: [ 0, 0, 0 ], translate: [[[ () => [ [[[150 - 300, 175 - 200]]], 100, 0] ]]],
          control: 'wen' }},
    }

    let p3 = {
      halo: 'ent',
      geofold,
      payload: {tim,
        boform,
        ric: {gid: 'p', cid: 'p', fid: 'p3'},
        proform: {projection: 'uniwen', scale: 1, rotate: [ 0, 0, 0 ], translate: [ [[[ t => (() => 175 - 300)() ]]], 100 - 200 ],
          control: 'wen' }},
    }

    let p4 = {
      halo: 'ent',
      geofold,
      payload: {tim,
        boform,
        ric: {gid: 'p', cid: 'p', fid: 'p4'},
        proform: {projection: 'uniwen', scale: 1, rotate: [ 0, 0, 0 ], translate: [ [[[ 200 - 300, 225 - 300 ]]], 100 - 200, 0 ],
          control: 'wen' }},
    }

    let p5 = {
      halo: 'ent',
      geofold,
      payload: {tim,
        boform,
        ric: {gid: 'p', cid: 'p', fid: 'p5'},
        proform: {projection: 'uniwen', scale: 1, rotate: [ 0, 0, 0 ], translate: {x: [[[250 - 300, 275 - 300]]], y: 100 - 200 },
          control: 'wen' }},
    }

    let p6 = {
      halo: 'ent',
      geofold,
      payload: {tim,
        boform,
        ric: {gid: 'p', cid: 'p', fid: 'p6'},
        proform: {
          projection: 'uniwen',
          translate: [[[ () => {
            let geo = {'type': 'LineString', 'coordinates': [ [300 - 300, 100, 0], [325 - 300, 100, 0], [300 - 300, 100 - 200, 0] ]}
            return mprops.ta(mlacer.unslide(geo.coordinates)) // dimensional triple array
          } ]]],
          control: 'wen' },
      }}

    let p7 = {
      halo: 'ent',
      geofold,
      payload: {tim,
        boform,
        ric: {gid: 'p', cid: 'p', fid: 'p7'},
        proform: {projection: 'uniwen',
          scale: 1,
          rotate: [ 0, 0, 0 ],
          translate: [[[ {
            'x': {
              'm1': 4, 'm2': 4, 'n1': 2, 'n2': 2, 'n3': 2, 'a': 1, 'b': 1, // circle
              'ra2': 100, 'v0': 0, 'v1': 1, 'w4': 90, 'seg5': 360, 'pa6': 0, 'pb7': -1,

            },
            'y': {
              'm1': 4, 'm2': 4, 'n1': 100, 'n2': 100, 'n3': 100, 'a': 1, 'b': 1, // square
              'ra2': 100, 'v0': 0, 'v1': 1, 'w4': 90, 'seg5': 360, 'pa6': 0, 'pb7': -1,

            },
          } ]]],
          control: 'wen',
        },
      }}

    let p8 = {
      halo: 'ent',
      geofold,
      payload: {tim,
        boform,
        ric: {'gid': 'p', 'cid': 'p', 'fid': 'p8'},
        proform: {projection: 'uniwen',
          scale: 1,
          rotate: [ 0, 0, 0 ],
          translate: [ [[[ {
            'm1': 4, 'm2': 4, 'n1': 2, 'n2': 2, 'n3': 2, 'a': 1, 'b': 1, // circle
            'ra2': 100, 'v0': 0, 'v1': 1, 'w4': 90, 'seg5': 360, 'pa6': 0, 'pb7': -1,

          } ]]],
          [[[ {
            'm1': 4, 'm2': 4, 'n1': 2, 'n2': 2, 'n3': 2, 'a': 1, 'b': 1, // circle
            'ra2': 100, 'v0': 0, 'v1': 1, 'w4': 90, 'seg5': 360, 'pa6': 0, 'pb7': -1,

          } ]]],
          ],
          control: 'wen',
        },
      }}

    let p10 = { // NOK
      halo: 'ent',
      geofold,
      payload: {tim,
        boform,
        ric: {'gid': 'p', 'cid': 'p', 'fid': 'p10'},
        proform: {projection: 'uniwen',
          scale: 1,
          rotate: [ 0, 0, 0 ],
          translate: [

            [[[ (t, a = 378, b = {
              'm1': 4, 'm2': 4, 'n1': 2, 'n2': 2, 'n3': 2, 'a': 1, 'b': 1, // circle
              'ra2': 100, 'v0': 0, 'v1': 1, 'w4': 90, 'seg5': 360, 'pa6': 0, 'pb7': -1,

            }) => {
              let as = a
              let bs = __mapper('xs').m('snap')(b, t, 1).x
              return as + bs
            } ]]],

            [[[ (t, a = 100, b = {
              'm1': 4, 'm2': 4, 'n1': 2, 'n2': 2, 'n3': 2, 'a': 1, 'b': 1, // circle
              'ra2': 100, 'v0': 0, 'v1': 1, 'w4': 90, 'seg5': 360, 'pa6': 0, 'pb7': -1,

            }) => {
              let as = a
              let bs = __mapper('xs').m('snap')(b, t, 1).y
              return as + bs
            } ]]],

          ],
          control: 'wen',
        },
      }}

    let p11 = {
      halo: 'ent',
      geofold,
      payload: {tim,
        boform,
        ric: {'gid': 'p', 'cid': 'p', 'fid': 'p11'},
        proform: {projection: 'uniwen',
          scale: 1,
          rotate: [ 0, 0, 0 ],
          translate: [[[ {
            'm1': 4, 'm2': 4, 'n1': 2, 'n2': 2, 'n3': 2, 'a': 1, 'b': 1, // circle
            'ra2': 100, 'v0': 0, 'v1': 1, 'w4': 90, 'seg5': 360, 'pa6': 0, 'pb7': -1,

          } ]]],
          control: 'wen',
        },
      }}

    let p12 = {
      halo: 'ent',
      geofold,
      payload: {tim,
        boform,
        ric: {'gid': 'p', 'cid': 'p', 'fid': 'p12'},
        proform: {projection: 'uniwen',
          scale: 1,
          rotate: [ 0, 0, 0 ],
          translate: [[[ (...args) => {
            let a = [[[ {
              'm1': 4, 'm2': 4, 'n1': 2, 'n2': 2, 'n3': 2, 'a': 1, 'b': 1, // circle
              'ra2': 100, 'v0': 0, 'v1': 1, 'w4': 90, 'seg5': 360, 'pa6': 0, 'pb7': -1,

            } ]]]
            if (args.length === 0) {
              return a
            } else {
              let as = args[0]
              return [ 100 + as.x, 100 + as.y ]
            }
          } ]]],
          control: 'wen',
        },
	 }}

    let p13 = {
      halo: 'ent',
      geofold,
      payload: {tim,
        boform,
        ric: {'gid': 'p', 'cid': 'p', 'fid': 'p13'},
        proform: {projection: 'uniwen',
          scale: 1,
          rotate: [ 0, 0 ],
          translate: [

            [[[ t => {
              let msnap = __mapper('xs').m('snap')
              let fn = (a, b) => a + b.x
              let args = [
                378,
                [[[ {
                  'm1': 4, 'm2': 4, 'n1': 2, 'n2': 2, 'n3': 2, 'a': 1, 'b': 1, // circle
                  'ra2': 100, 'v0': 0, 'v1': 1, 'w4': 90, 'seg5': 360, 'pa6': 0, 'pb7': -1,

                } ]]],
              ]
              args = args.map(d => msnap(d, t, 0))
              return fn(...args)
            } ]]],

            [[[ (t, a = 100, b = {
              'm1': 4, 'm2': 4, 'n1': 2, 'n2': 2, 'n3': 2, 'a': 1, 'b': 1, // circle
              'ra2': 100, 'v0': 0, 'v1': 1, 'w4': 90, 'seg5': 360, 'pa6': 0, 'pb7': -1,

            }) => {
              let msnap = __mapper('xs').m('snap')
              let as = a
              let bs = msnap(b, t, 1).y
              return as + bs
            } ]]],

          ],
          control: 'wen',
        },
      }}

    let p15 = {
      halo: 'ent',
      geofold,
      payload: {tim,
        boform,
        ric: {'gid': 'p', 'cid': 'p', 'fid': 'p15'},
        proform: {projection: 'uniwen',
          scale: 1,
          rotate: [ 0, 0 ],
          center: [ [[[ 100, 325 ]]], 100, 0 ],
          translate: [[[ {
            'm1': 4, 'm2': 4, 'n1': 2, 'n2': 2, 'n3': 2, 'a': 1, 'b': 1, // circle
            'ra2': 100, 'v0': 0, 'v1': 1, 'w4': 90, 'seg5': 360, 'pa6': 0, 'pb7': -1,

          } ]]],
          control: 'wen',
        },
      }}

    let p16 = {
      halo: 'ent',
      geofold,
      payload: {tim,
        boform,
        ric: {'gid': 'p', 'cid': 'p', 'fid': 'p16'},
        proform: {projection: 'uniwen',
          scale: 1,
          rotate: [ 0, 0 ],
          center: [ [[[ 300, 225 ]]], 300, 0 ],
          translate: [[[ {
            'm1': 4, 'm2': 4, 'n1': 2, 'n2': 2, 'n3': 2, 'a': 1, 'b': 1, // circle
            'ra2': 100, 'v0': 0, 'v1': 1, 'w4': 90, 'seg5': 360, 'pa6': 0, 'pb7': -1,

          } ]]],
          control: 'wen',
        },
        stace: [[[ {
          'm1': 4, 'm2': 4, 'n1': 2, 'n2': 2, 'n3': 2, 'a': 1, 'b': 1, // circle
          'ra2': 100, 'v0': 0, 'v1': 1, 'w4': 90, 'seg5': 360, 'pa6': 0, 'pb7': -1,

        } ]]],

      }}

    let animas = [
    // p1, // h.ent g.uniwen
    // p2, // h.ent g.uniwen
    // p3, // h.ent g.uniwen
    // p4, // h.ent g.uniwen
    // p5, // h.ent g.uniwen
    // p6, // h.ent g.uniwen
      p7, // h.ent g.uniwen
    // p8, // h.ent g.uniwen

    // p10, // h.ent g.uniwen
    // p11, // h.ent g.uniwen
    // p12, // h.ent g.uniwen
    // p13, // h.ent g.uniwen

    // p15, // h.ent g.uniwen
    // p16, // h.ent g.uniwen

    ]

    return animas
  }

  let enty = () => {}
  enty.animas = animas
  return enty
}
</script>