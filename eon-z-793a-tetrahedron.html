<script src="eon-x-eonify.js"></script>
<script>
window.xEonify.eon({anitem, time: undefined})

// .................. anitem
async function anitem (__eo) {
  let [
    d3,
    d3Geo,
    THREE,
    ctlWen,
    eohalMars,
    muonGeom,
    muonNets,
    muonProps,
    renderPortview,
    renderWebgl,
  ] = await Promise.all([
    __eo('xs').b('d3'),
    __eo('xs').b('d3-geo'),
    __eo('xs').b('three'),
    __eo('xs').c('wen'),
    __eo('xs').e('mars'),
    __eo('xs').m('geom'),
    __eo('xs').m('nets'),
    __eo('xs').m('props'),
    __eo('xs').r('portview'),
    __eo('xs').r('webgl'),
  ])

  let ani = function () {
  // .................. pics

    let epsilon = 1e-6, epsilon2 = epsilon * epsilon, asin = Math.asin
    let atan = Math.atan, abs = Math.abs
    let pi = Math.PI, degrees = 180 / pi, asin1_3 = Math.asin(1 / 3)
    let sqrt = Math.sqrt
    let theta = atan(0.5) * degrees

    const eotim = {'td': 9800, 't0': 0, 't1': 1, 't2': 1, 't3': 1, nostop: 1}

// http://netlib.org/polyhedra/
// https://github.com/paaatrick/polyhedra-folding/blob/master/poly/0
let def = `
:name
tetrahedron
:number
0
:symbol
{3,3}	@Y sub 3 @
:dual
tetrahedron
:sfaces
4 4{3}
:svertices
4 4(@3 sup 3@)
:net
4 3
3 1 2 4
3 3 1 4
3 1 0 2
3 4 2 5
:solid
4 3
3 7 9 8
3 6 7 8
3 7 6 9
3 8 9 6
:hinges
3
0 0 2 2 1.2309594173407747
0 1 3 0 1.2309594173407747
0 2 1 1 1.2309594173407747
:dih
1
6 3 3 1.2309594173407747
:vertices
10 6
-1[-1] -.577350269189626[(-1/3)*sqrt(3)] 0[0]
-.5[-1/2] .288675134594813[(1/6)*sqrt(3)] 0[0]
0[0] -.577350269189626[(-1/3)*sqrt(3)] 0[0]
0[0] 1.15470053837925[(2/3)*sqrt(3)] 0[0]
.5[1/2] .288675134594813[(1/6)*sqrt(3)] 0[0]
1[1] -.577350269189626[(-1/3)*sqrt(3)] 0[0]
-1.3333333333333333 -.76980035891950045 -1.0886621079036349
-.83333333333333384 -1.0584754935143137 -.27216552697590904
-.5000000000000002 -.28867513459481264 -.81649658092772612
-.44444444444444495 -1.2188505682892098 -1.1793839502289383
:EOF`




    // .................. facesAni anima
    let facesAni = {

      eohal: 'sol',
      eotim: eotim,
      eoric: {gid: 'facesAni', cid: 'facesAni', fid: 'facesAni'},

      eofold: anitem => {
        let tim = anitem.eoload.tim
        let faceColors = anitem.eoload.faceColors
        let lineColors = anitem.eoload.lineColors
if (1 && 1) console.log('tim', tim)
if (1 && 1) console.log('faceColors', faceColors)
        
        let net = muonNets.parse({text:def})
        let threeObject = muonNets.duce({net, faceColors, lineColors})

        
        muonNets.update_matrices(threeObject, tim)

        let eoload = anitem.eoload
        let json = { // Feature
          type: 'Feature',
          geometry: { type: 'Point', coordinates: [0,0,0], },
          properties: {
            object: threeObject,
            sort: 'threeobject',
          },
        }

        return json
      },

      eocrom: {'csx': 0, 'cf': [[[222, 333, 222, 333, 222, 333, 222]]], 'cs': 777, 'cw': 0.6, 'co': 0.999, 'cp': 0.999},

      eomot: {
        proform: {

          projection: 'uniwen',
          translate: [ 0, 0, 0 ],
          scale: [30, 30, 30],
          rotate: [[[[0, 6, 0]]], [[[0, 360]]], [[[0, 6, 0]]]],
          lens: [0, 1, Infinity ],

        },
      },
      eoload: {
        tim: [[[0,0,1]]],
        faceColors: [
          [ [[[ 0.1, 0.9 ]]], 0.2, 0.2 ],
        ],
        lineColors: [
          [0.7,0.5,0.2],
        ],        
      },
    }
    // .................. cameraPersAni anima
    let cameraPersAni = {

      eotim: eotim,
      eoric: {gid: 'camera', cid: 'camera', fid: 'cameraPersAni'},
      eohal: 'sol',

      eofold: anitem => {
        let eoload = anitem.eoload
        let json = { // Feature
          type: 'Feature',
          geometry: { type: 'Point', coordinates: [0, 0, 0] },
          properties: {
            sort: 'camera',
            type: 'PerspectiveCamera',
            name: 'Perspective',
            fov: 90, // field of view s the field of view. angle in degrees.
            aspect: renderPortview.width() / renderPortview.height(),
            near: 0.001,
            far: 6,

            position: [0, 0, 1 ],
            rotation: [0, 0, 0 ],
            distance2nodesFactor: 100,
            lookAt: [0, 0, 0],
          },
        }
        return json
      },
    }
    // .................. cameraOrthoAni anima
    let cameraOrthoAni = {

      eotim: eotim,
      eoric: {gid: 'camera', cid: 'camera', fid: 'cameraOrthoAni'},
      eohal: 'sol',

      eofold: anitem => {
        let eoload = anitem.eoload
        let json = {
          type: 'Feature',
          geometry: { type: 'Point', coordinates: [0, 0, 0] },
          properties: {
            sort: 'camera',
            type: 'OrthographicCamera',
            name: 'Orthographic',

            left:   -1,
            right:   1,
            top:     1,
            bottom: -1,

            near: 0.001,
            far: 6,

            position: [0, 0, 2],
            rotation: [0, 0, 0],
            distance2nodesFactor: 100,
            lookAt: [0, 0, 0],
          },
        }

        return json
      },

    }

    // .................. animas
    let animas = [

      facesAni, // h.mars
      // cameraPersAni, // h.sol
      cameraOrthoAni, // h.sol
    ]
    return animas
  }

  let enty = () => {}
  enty.ani = ani
  return enty
}
</script>