<!DOCTYPE html>
<meta charset="utf-8">
<title>animas</title>
<head >

  <style>
    body { margin:0;position:fixed;top:0;right:0;bottom:0;left:0; }
    div#fps,svg { position: fixed; top:0; left:0; color: white; }
  </style>

</head>
<body style="cursor:crosshair"></body>
<div id="viewframe" class="viewframe"></div>

<script src="elem-enls.js"></script>
<script src="elem-ents.js"></script>

<script>

let __mapper = xMapper.xMapper()
let xxs = __mapper({'xs': xs.xs(__mapper)}).xs  // register and assign proxy

let mstorePromise = 	__mapper('xs').m('store')
let banimationPromise = 	__mapper('xs').b('animation')

animasPromise(__mapper)
  .then(function(animas){
      xxs.m('store').apply({type: 'UPDANIMA', animas: animas})
  })

__mapper({'bosonAnimation': bosonAnimation.bosonAnimation(__mapper)})


async function animasPromise(__mapper) {

  let rrenderportPromise = __mapper('xs').r('renderport'),
    propsPromise = __mapper('xs').m('props'),
    cwenPromise = __mapper('xs').c('wen'),
    mnatPromise = __mapper('xs').m('nat')
    
  let bpromisedPromise = __mapper('xs').b('promise') // modifies global state in mapper
  
  let [rrenderport, f, cwen, mnat, bpromised] 
      = await Promise.all([rrenderportPromise, propsPromise, cwenPromise, mnatPromise, bpromisedPromise])
  
  let width = rrenderport.width(),
    height = rrenderport.height(),
    scaleProj = Math.min(width / 2, height) / Math.PI

  let radians = Math.PI / 180, degrees = 180 / Math.PI,
    sin = Math.sin, cos = Math.cos, sqrt = Math.sqrt


        let tspan = bpromised.add(9000,600)
        
        // ............................. pics
        let tim = {'td': tspan, 't0': 0, 't1': 1000, 't2': 1, 't3': 1, nostop:1, tf: t => t}


        let conform = {
          'x': {
            'm1': 4, 'm2': 4, 'n1': 2, 'n2': 2, 'n3': 2, 'a': 1, 'b': 1,  // circ
            'ra2': 120,'v0': 0,'v1': 1,'w4': 0 ,'seg5': 24,'pa6': 0,'pb7': -1,
            'dom3': [-180, 180],  // r.form.circ [-1.57, 1.57]
            'fn0': (r,s, u=0,v=0, a,b, c=1,d=1) =>  r  * cos(v),
          },
          'y': {
            'm1': 4, 'm2': 4, 'n1': 2, 'n2': 2, 'n3': 2, 'a': 1, 'b': 1,  // circ
            'ra2': 120,'v0': 0,'v1': 1,'w4': 0 ,'seg5': 24,'pa6': 0,'pb7': -1,
            'dom3': [-180, 180],
            'fn0': (r,s, u=0,v=0, a,b, c=1,d=1) =>  r * r,
          },

          'z': {
            'm1': 4, 'm2': 4, 'n1': 2, 'n2': 2, 'n3': 2, 'a': 1, 'b': 1,  // circ
            'ra2': 120,'v0': 0,'v1': 1,'w4': 0 ,'seg5': [[[6,18,18]]],'pa6': 0,'pb7': -1,
            'dom3': [-180, 180],
            'fn0': (r,s, u=0,v=0, a,b, c=1,d=1) => r * sin(v),
          },

          'r': {
            'm1': 4, 'm2': 4, 'n1': 2, 'n2': 2, 'n3': 2, 'a': 1, 'b': 1,  // circ
            'ra2': 120,'v0': 0,'v1': 1,'w4': 0 ,'seg5': [[[6,18,18]]],'pa6': 0,'pb7': -1,
            'dom3': [-180, 180],
          },

        }

        let boform = { 'csx': 0, 'cf': [[[111, 111, 111]]], 'co': [[[0.09, 0.09]]],
            'cs': [[[888, 777, 888]]], 'cw': [[[1.9, 1.9, 1.9]]], 'cp': [[[0.9, 0.9]]]}

        // ............................. natForm
        let natForm = {

          halo: 'nat',

          geofold: p => mnat.natFeature(p.payload.form), // geofold: p => mnat.closeFeature(mnat.natFeature(p.payload.form)),
          payload: {
            tim,

            ric: {gid: 'q', cid: 'q', fid: 'q'},

            proform: {

                projection: 'uniwen',
                // scale: [1, 1],
                scale: [0.5, 0.5],

                // projection:  d3.geoOrthographic(),
                // scale: 100,

                prerotate: [[[ cwen.rotation ]]],
                translate: [ [0, 0, 0] ],
                rotate: [ [[[90 + 0, 90 + 0, 90 + 1 * 360, 90 + 1 * 360]]], 0, 0 ],
                // rotate: [ 0, 0, 0 ],
                lens: [0, 1, Infinity],
              },

            boform: boform,

            form: conform,

          }

        }
        // .................. sceneForm
        let sceneForm = {

          halo: 'scene',
          payload: {

            tim: tim,

            ric: {gid: 'scene', cid: 'scene', fid: 'scene'},

            context: {svg: 1, versor: 0, wen: 1, webgl: 0, bck: 0}
          }

        }
        // ............................. animas
        let animas = [

          sceneForm, // h.scene
          natForm, // h.nat

        ]

        return animas


    // })
    

}


</script>
<body style="cursor:crosshair"></body>