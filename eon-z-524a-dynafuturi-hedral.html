<script src="eon-x-eonify.js"></script>
<script>
window.xEonify.eon({anitem, time: undefined})

// .................. anitem
async function anitem (__mapper) {
  // .................. eons
  let [
    mprops,
    cwen,
    mnat,
    mgeom,
    mgraticule,
    topojson,
    dworldTopo110m,
    prtHedrals,
  ] = await Promise.all([
    __mapper('xs').m('props'),
    __mapper('xs').c('wen'),
    __mapper('xs').m('nat'),
    __mapper('xs').m('geom'),
    __mapper('xs').m('graticule'),
    __mapper('xs').b('topojson'),
    __mapper('xs').d('worldTopo110m'),
    __mapper('xs').p('hedrals'),
  ])

  // .................. animas
  let ani = function () {
    let tim = {'td': 18200, 't0': 0, 't1': 1000, 't2': 1, 't3': 1}

    let proform = {

      'projection': 'hedrals',
      'scale': 30,
      'rotate': [ [[[0, -60]]], [[[0, -60]]], [[[0, -60]]] ],
      'translate': [ 0, 0 ],

      'trees': [
        [-1, 4, 5, 2, 0, 1],
        [-1, 4, 5, 0, 0, 1],
        [-1, 0, 0, 0, 0, 4],

        [-1, 2, 3, 0, 1, 4],
        [-1, 2, 0, 2, 1, 1],
        [-1, 0, 1, 2, 1, 2],
        [-1, 4, 1, 2, 0, 3],
        [-1, 0, 1, 2, 1, 2],
        [-1, 0, 1, 2, 0, 2],
        [-1, 0, 1, 5, 0, 2],
      ],
      'treeidx': [[[0, 9.1, 0]]],
      'faciaRotation': [[[Math.PI / 1, Math.PI / 1]]],

      'vertices': [
        [-1, -1, 1], // 0  // 0
        [ 1, -1, 1], // 1  // 1
        [ 1, 1, 1], // 2  // 2
        [-1, 1, 1], // 3  // 3
        [-1, -1, -1], // 5  // 4
        [ 1, -1, -1], // 4  // 5
        [ 1, 1, -1], // 7  // 6
        [-1, 1, -1], // 6  // 7
      ].map(mgeom.normalize) // eg. [0.5773, -0.577, 0.5773]
        .map(mgeom.spherical) // eg. [-0.7853, 0.6154]
        .map(mgeom.to_degrees),

      'faces': [
        [1, 0, 3, 2, 1], // N
        [1, 2, 6, 5, 1],
        [2, 3, 7, 6, 2],
        [3, 0, 4, 7, 3],
        [0, 1, 5, 4, 0],
        [5, 6, 7, 4, 5], // S
      ],

    }

    // ............................. geograt
    let geograt = {

      halo: 'ent',

      geofold: anitem => mgraticule.vhMultiLine(anitem.payload.graticule),
      tim: tim,
      ric: {'gid': 'geograt', 'cid': 'geograt', 'fid': 'geograt'},
      boform: { 'csx': 0, 'cf': [[[111, 111]]], 'cs': 666, 'cw': 0.39, 'co': [[[0.5, 0.5]]], 'cp': [[[0.9, 0.9]]]},

      geodrift: {
        proform: proform,
      },
      graticule: {

        'frame': [ [ [-180, 180, 45, 45], [-90, 90, 22.5, 22.5] ],
          [	[-180, 180, 45, 45], [-90, 90, 22.5, 22.5] ] ],

      },
      payload: {

      },

    }

    // ............................. geoearth
    let geoearth = {

      halo: 'ent',

      geofold: p => {
        let geometry = Object.assign({},
          topojson.mesh(
            dworldTopo110m.data(),
            dworldTopo110m.data().objects.land
          )
        )
        return { type: 'Feature', geometry: geometry, properties: {} }
      },
      tim: tim,
      ric: {'gid': 'geoearth', 'cid': 'geoearth', 'fid': 'geoearth'},
      boform: { 'csx': 0, 'cf': [[[555, 333, 555, 333, 555, 333, 555]]], 'cs': 333, 'cw': 0.2, 'co': 0.4, 'cp': 0.9},

      geodrift: {
        conform: proform,
      },
      payload: {
      },
    }

    // -------------------------------  geoearth
    let geoshpere = {

      halo: 'ent',

      geofold: {
        type: 'Feature',
        geometry: {
          type: 'Sphere',
        },
        properties: {},
      },
      tim: tim,
      ric: {'gid': 'geoshpere', 'cid': 'geoshpere', 'fid': 'geoshpere'},
      boform: { 'csx': 0, 'cf': 444, 'cs': 333, 'cw': 0.9, 'co': 0.4, 'cp': 0.9},

      geodrift: {
        proform: proform,
      },
      payload: {
      },

    }

    // -------------------------------  text
    let text = {

      halo: 'textform',
      geofold: null,

      tim: tim,
      ric: {'gid': 'text', 'cid': 'text', 'fid': 'text'},
      boform: { 'csx': 0, 'cf': [[[888, 777]]], 'cs': 111, 'cw': [[[0.1, 0.7]]], 'co': [[[0.6, 0.99]]], 'cp': [[[0.5, 0.5]]]},

      geodrift: {
        proform: {
          projection: 'uniwen',
          translate: [ -250, 0 ],
        },
      },

      payload: {
        textform: {
          string: 'nine realms unified by the world tree yggdrasil.',
          style: {
            rotate: [[[ 0, -1 ]]],
            'font-size': [[[10, 60]]],
            'font-family': 'BankFuturistic',
            'text-anchor': 'center',

          },
        },

      },
    }

    // ............................. animas
    let animas = [
      geograt, // h.ent g.hedrals
      geoearth, // h.ent g.hedrals
      geoshpere, // h.ent g.hedrals

      text, // h.text
    ]

    return animas
  }

  let enty = () => {}
  enty.ani = ani
  return enty
}
</script>