<script src="eon-x-eonify.js"></script>
<script>
window.xEonify.eon({anitem, time: undefined})

// .................. anitem
async function anitem (__eo) {
  // .................. eons
  let [
    ctlWen,
    eohalMars,
    eohalSol,
    muonProps,
    muonSoma,
    renderSvg,

    muonGeoj,
    muonLacer,
    muonLindenmayer,
    muonSnap,
    prtUniwen,
  ] = await Promise.all([
    __eo('xs').c('wen'),
    __eo('xs').e('mars'),
    __eo('xs').e('sol'),
    __eo('xs').m('props'),
    __eo('xs').m('soma'),
    __eo('xs').r('svg'),

    __eo('xs').m('geoj'),
    __eo('xs').m('lacer'),
    __eo('xs').m('lindenmayer'),
    __eo('xs').m('snap'),
    __eo('xs').p('uniwen'),

  ])

  let muonStore = __eo('muonStore')

  // .................. animas
  let ani = function () {
    let animas = []

    let aniFormA = {

      eotim: { td: 24200, t0: 0, t1: 1, t2: 1, t3: 1, nostop: 1 },
      eoric: { gid: 'ani', cid: 'ani', fid: 'aniA' },
      eohal: 'mars',

      eofold: ani => {
        let gj = muonLindenmayer.lindenmayer(ani.eoload.lindenmayer)
        return gj
      },

      eocrom: { 'csx': 6, 'cf': [[[111, 999]]], 'cs': 666, 'cw': [[[0.9, 0.9]]], 'co': [[[0.7, 0.7]]], 'cp': [[[0.9, 0.9]]]},
      eomot: {
        proform: {
          projection: 'uniwen',
          scale: [0.33, 0.33, 0.33],
          translate: {x: -150, y: 100 },

          rotate: [ 0, 0, 0 ],
        },
      },
      eoload: {

        lindenmayer: { // Penrose3
          linden: {
            axiom: '[N]++[N]++[N]++[N]++[N]',
            loopq: 4,
            rules: {
              M: 'OF++PF----NF[-OF----MF]++',
              N: '+OF--PF[---MF--NF]+',
              O: '-MF++NF[+++OF++PF]-',
              P: '--OF++++MF[+PF++++NF]--NF',
              F: '',
            },
          },
          mayer: {
            side: 24,
            angunit: 36,
            anglestart: 0,
            start: [0, 0],
          },
        },

      },
    }

    // .................. pics
    let aniForm = {

      eohal: 'mars',
      eotim: { td: 12800, t0: 0, t1: 1, t2: 1, t3: 1, nostop: 0 },
      eoric: { gid: 'ani', cid: 'ani', fid: 'ani' },

      eofold: ani => {
        let t = ani.eotim.unElapsed

        let gj1 = muonLindenmayer.lindenmayer(ani.eoload.lindenmayer1)
        let coors1 = gj1.geometry.coordinates[0]

        return gj1
      },

      eocrom: { 'csx': 6, 'cf': 999, 'cs': 111, 'cw': 0.9, 'co': 0.99, 'cp': 0.9},
      eomot: {
        proform: {

          projection: 'uniwen',
          //          0       1   2     3     4     5
          scale: 3.50,
          translate: {x: -275, y: -100 },
          rotate: [ 0, 0, 0 ],

        },
      },
      eoload: {
        lindenmayer1: { //
          linden: {
            axiom: 'AFA+F+AFA',
            loopq: 3,
            feet: 1,
            rules: {
              A: '-BF+AFA+FB-',
              B: '+AF-BFB-FA+',
            },
          },
          mayer: {
            side: 1,
            angunit: 36,
            anglestart: 0,
            start: [0, 0],
          },
        },

      },
    }

    // .................. somaAni
    let somaAni = {

      eohal: 'mars',
      eotim: {'td': 6800, 't0': 0, 't1': 1, 't2': 1, 't3': 1},
      eoric: { gid: 'ani', cid: 'ani', fid: 'ani2'},

      eofold: null,

      eocrom: {csx: 3, cf: 555, cs: 111, cw: 6.9, co: 0.0072, cp: 0.69},
      eoload: {},
    }

    let p = {
      // eocrom: {csx: 2, cf: 555, cs: 111, cw: 2.9, co: 0.0072, cp: 0.99},
      // eocrom: {csx: 3, cf: 555, cs: 111, cw: 6.9, co: 0.0072, cp: 0.99},
      x0: 0, y0: -160,
      growthDir: Math.PI / 2,

      depth: [[[0, 7]]], // [[[0, 12]]], // depth iter

      growunit: 8, // rate of feature growth in tick
      maxSpreadAngle: 1 * Math.PI / 2, // max abs ang delta
      mitoDirections: [ -1.1, 0, 0.9 ], // [ -1.1, 0.9 ], // number of deviations

      shrinkage: 0.8, // 0.9, // size shrink
      colordelta: 150, // 100, // color delta between gens

      subgrow: 1, // inside growth
      subgrowunit: [1, 0.1, 1], // rate of feature growth in tick
      subSpreadAngle: Math.PI / 12, // width of secondary deviation
      subMitoDirs: [0.1], // direction in stems
      subShrinkage: 0.9, // size shrink
      subgrowrate: (i, q) => 1,
    }

    let q = 20
    let treeanis = []
    for (let i = 0; i < q; i++) {
      let anii = muonProps.clone(somaAni)
      anii.eoload.soma = p
      anii.eoload.soma.x0 = 100
      anii.eoload.soma.y0 = -100
      anii.eoric.fid = 'ani' + i

      anii.eofold = muonSoma.somafold

      treeanis.push(anii)
    }

    // .................. animas
    animas.push(aniFormA)
    animas.push(aniForm)
    animas = animas.concat(treeanis)

    return animas
  }

  let enty = () => {}
  enty.ani = ani
  return enty
}
</script>


