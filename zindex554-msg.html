<!DOCTYPE html>
<meta charset="utf-8">
<title>animas</title>
<head >

  <style>
    body { margin:0;position:fixed;top:0;right:0;bottom:0;left:0; }
    div#fps,svg { position: fixed; top:0; left:0; color: white; }
  </style>
	
</head>
<body style="cursor:crosshair"></body>

<!--  d3   -->
<!-- <script src="https://d3js.org/d3.v4.min.js"></script> -->
<!-- <script src="https://d3js.org/d3-geo.v1.min.js"></script> -->
<!-- <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script> -->
<!-- <script src="https:////unpkg.com/d3-force-3d@1.0/build/d3-force-3d.bundle.min.js"></script> -->
<!--  topojson   -->
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/3.0.0/topojson.min.js"></script> -->
<!--  three   -->
<!-- <script src="https:////cdnjs.cloudflare.com/ajax/libs/three.js/84/three.min.js"></script> -->
<!-- <script src="https:////unpkg.com/three-trackballcontrols-web@0.0.2/dist/three-trackballcontrols.min.js"></script> -->
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.6.5/dat.gui.min.js"></script> -->
<!-- <script src="https://unpkg.com/d3-force-magnetic@0.6.1/dist/d3-force-magnetic.min.js"></script> -->


<div id="viewframe" class="viewframe"></div>
<script src="ents.js"></script>

<script>
/*******************************************
 * 			@PLUGIN
 *
 */	
	var muonAlima = function muonAlima(__mapper) {

		let props = __mapper('xs').m('props')	// props
		let f = props.lib																// function
		let local = {}																	// local
		
		__mapper({"xs": xs.xs(__mapper)})								// PROXIES
		
		// __mapper({"renderCanvas": renderCanvas.renderCanvas(__mapper)})	// CANVAS
		
		__mapper({"renderSVG": renderSVG.renderSVG(__mapper)})						// SVG
		__mapper("xs").c("versor").control(__mapper("renderSVG").svg()) // SVG VERSOR	
		// __mapper("xs").c("pos")(__mapper("renderSVG").svg())		// SVG POSITION
		__mapper("xs").m("image")("zimg-black.jpg")				// BCK IMAGE
		
		__mapper({"renderWebgl": renderWebgl.renderWebgl(__mapper)})				// WEBGL
		
		__mapper({'muonAnimation': muonAnimation.muonAnimation(__mapper)})	// ANIMATION
		__mapper({'muonStore': muonStore.muonStore(__mapper)})				// STORE
		
		__mapper("xs").c("key").start()									// KEYBRD CONTROLS	
		
/*******************************************
 * 		@controls
 * 
 */					
	// .............................................. gui
		// gui = new dat.GUI()
		// gui.add(window, "restart")
		
	// .............................................. RightArrowAlt
	let controltimerRightArrowAlt = () => {

		if (__mapper("muonAnimation").animationStop !== undefined)
			{
			console.log("started",__mapper("controlTimer").started())
			if (__mapper("controlTimer").started()) {
					__mapper("controlTimer").stop()
			} else {
					console.log("controlTimer resume")
					__mapper("controlTimer").resume()
			}	
		}
	}
	__mapper("controlKey").subscribe(controltimerRightArrowAlt, "rightArrowAlt")
	
	
	let mouseDownListener = function mouseDownListener(event) {
		
		__mapper("xs").m("mouse").mouseDown(1)
		__mapper("xs").m("mouse").mouseDownShared(1)
		__mapper("xs").m("mouse").event(event)

	}		

	let mouseUpListener = function mouseUpListener(event) {

		__mapper("xs").m("mouse").mouseDown(0)
		__mapper("xs").m("mouse").mouseDownShared(0)
		
	}
	__mapper("xs").c("key").start()									// MOUSE
	
	if (__mapper("renderSVG")) __mapper("xs").c("mouseDown").control(__mapper("renderSVG").svg()).subscribe(mouseDownListener, __mapper("renderSVG").svg())
	if (__mapper("renderSVG")) __mapper("xs").c("mouseUp").control(__mapper("renderSVG").svg()).subscribe(mouseUpListener, __mapper("renderSVG").svg())	
	
/*******************************************
 * 		@FPS
 * 
 */				
// const fpsdiv = d3.select('body').append('div').attr('id','fps') 
// __mapper("xs").m("fps").init()	

/*******************************************
 * 		@STATS
 * 
 */				
var stats = __mapper("xs").m("stats")() // new Stats();
stats.showPanel( -1 ); // 0: fps, 1: ms, 2: mb, 3+: custom
document.body.appendChild( stats.dom );
function animate() {
	stats.begin();	/* monitored code goes here */; stats.end()
	requestAnimationFrame( animate )
}
requestAnimationFrame( animate )

/*******************************************
 * 		@vars
 * 
 */				
let tim = {"td":12800,"t0":0,"t1":1000,"t2":1,"t3":1,}

let state = {
					"x": [[[200,400]]],
					"y": 100,
					"z": 0,
			}
let projection = {
					"projection": "identity",
					"scale": 1,
					"translate": [ 300, 200 ],
					"rotate": [ 0, 0, 0 ],
			}		
/*******************************************
 * 		@animas
 * 
 */					
let msg = {
			"pic": {
				"tim": tim,
				"ric": {"gid":"msgg","cid":"msgc","fid":"msgf",},
				"halo": "msg",

				"state": state,
				"ture": { "csx":0,"cf":[[[500,666]]],"co":[[[0.9,0.9]]],"cs":[[[111,666]]],"cw":[[[0.3,0.9]]],"cp":[[[0.7,0.9]]],},
				
				"projection": projection,
				"msg": {
					"txt":"bird form",
					"size":12,
				},
				
			},
	}

/*******************************************
 * @animaApi
 * 
 */

		
		let animas = [
			msg,			// msg
		] 

		var animaApi = function animaApi() {
			
				for (let i=0; i < animas.length; i++) {
					let anima = animas[i]
					let newAnimas = __mapper("xs").m("store").ween(anima)
						__mapper("xs").m("store").apply({"type":"UPDANIMA","caller":"alima","animas":newAnimas})
					
				}
			
		}
	
	return animaApi

}

var __mapper = muonMapper.muonMapper()
var muonAlima = __mapper({'muonAlima': muonAlima(__mapper)}).muonAlima(__mapper)
</script>
<body style="cursor:crosshair"></body>
