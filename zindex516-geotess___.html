<!DOCTYPE html>
<meta charset="utf-8">
<title>animas</title>
<head >

  <style>
    body { margin:0;position:fixed;top:0;right:0;bottom:0;left:0; }
    div#fps,svg { position: fixed; top:0; left:0; color: white; }
  </style>
	
</head>
<body style="cursor:crosshair"></body>

<!--  d3   -->
<!-- <script src="https://d3js.org/d3.v4.min.js"></script> -->
<!-- <script src="https://d3js.org/d3-geo.v1.min.js"></script> -->
<!-- <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script> -->
<!-- <script src="https:////unpkg.com/d3-force-3d@1.0/build/d3-force-3d.bundle.min.js"></script> -->
<!--  topojson   -->
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/3.0.0/topojson.min.js"></script> -->
<!--  three   -->
<!-- <script src="https:////cdnjs.cloudflare.com/ajax/libs/three.js/84/three.min.js"></script> -->
<!-- <script src="https:////unpkg.com/three-trackballcontrols-web@0.0.2/dist/three-trackballcontrols.min.js"></script> -->

<div id="viewframe" class="viewframe"></div>
<script src="ents.js"></script>

<script>
/*******************************************
 * 			@PLUGIN
 *
 */	
	var muonAlima = function muonAlima(__mapper) {

		let props = __mapper('xs').m('props')	// props
		let f = props.lib																// function
		let local = {}																	// local
		
		__mapper({"xs": xs.xs(__mapper)})								// PROXIES
		
		// __mapper({"renderCanvas": renderCanvas.renderCanvas(__mapper)})	// CANVAS
		
		__mapper({"renderSVG": renderSVG.renderSVG(__mapper)})						// SVG
		__mapper("xs").c("versor").control(__mapper("renderSVG").svg()) // SVG VERSOR	
		// __mapper("xs").c("pos")(__mapper("renderSVG").svg())		// SVG POSITION
		__mapper("xs").m("image")("zimg-black.jpg")				// BCK IMAGE
		
		// __mapper({"renderWebgl": renderWebgl.renderWebgl(__mapper)})				// WEBGL
		
		__mapper({'bosonAnimation': bosonAnimation.bosonAnimation(__mapper)})	// ANIMATION
		__mapper({'muonStore': muonStore.muonStore(__mapper)})				// STORE
		
		__mapper("xs").c("key").start()									// KEYBRD CONTROLS	

	// .............................................. RightArrowAlt
	let controltimerRightArrowAlt = () => {

		if (__mapper("bosonAnimation").animationStop !== undefined)
			{
			console.log("started",__mapper("controlTimer").started())
			if (__mapper("controlTimer").started()) {
					__mapper("controlTimer").stop()
			} else {
					console.log("controlTimer resume")
					__mapper("controlTimer").resume()
			}	
		}
	}
	__mapper("controlKey").subscribe(controltimerRightArrowAlt, "rightArrowAlt")
		
/*******************************************
 * @fps
 * 
 */				
// const fpsdiv = d3.select('body').append('div').attr('id','fps') 
// __mapper("xs").m("fps").init()	

/*******************************************
 * @stats
 * 
 */				
var stats = __mapper("xs").m("stats")() // new Stats();
stats.showPanel( -1 ); // 0: fps, 1: ms, 2: mb, 3+: custom
document.body.appendChild( stats.dom );
function animate() {
	stats.begin();	/* monitored code goes here */; stats.end();
	requestAnimationFrame( animate );
}
requestAnimationFrame( animate );		

/*******************************************
 * @features
 * 
 */				
let tim = {"td":12200,"t0":0,"t1":1000,"t2":1,"t3":1,}
let form =  {
			
				"x": {
					"m1":[[[4,4]]],"m2":[[[4,4]]],"n1":2,"n2":2,"n3":2,"a":1,"b":1,// circle
					"m1":3,"m2":3,"n1":1,"n2":1,"n3":1,"a":1,"b":1,// 
					"m1":4,"m2":4,"n1":2,"n2":2,"n3":2,"a":1,"b":1,// circle
					// "m1":4,"m2":4,"n1":100,"n2":100,"n3":100,"a":1,"b":1, // square
					
					"ra2": 162,
					"v0": 0,"v1":1,
					// "w4":  [[[0,0,0,-9 * 90,-9 * 90 ,0 ,0]]], 
					"w4":  0, 
					// "w4":  [[[180,360,180]]], // [[[0,-360,0]]],
					"seg5": 360,"pa6":0,"pb7":-1,
					"fas8": 0,
				},
				"y": {
					"m1":[[[4,4]]],"m2":[[[4,4]]],"n1":2,"n2":2,"n3":2,"a":1,"b":1, // circle
					"m1":3,"m2":3,"n1":1,"n2":1,"n3":1,"a":1,"b":1,// 
					"m1":4,"m2":4,"n1":2,"n2":2,"n3":2,"a":1,"b":1,// circle
					// "m1":4,"m2":4,"n1":100,"n2":100,"n3":100,"a":1,"b":1, // square
												
					"ra2": 162,
					"v0":0,"v1":1,
					"w4": 0, 
					// "w4": [[[0,0,0,-9 * 90,-9 * 90, 0 ,0]]], 
					// "w4":  [[[60, 60 + 1 * 360]]], // [[[0,-360,0]]],
					"seg5": 360,"pa6":0,"pb7":-1,
					"fas8": 0, 		// fas8, antifase
				},
				"z": {
					// "m1":[[[3,3]]],"m2":[[[3,3]]],"n1":1,"n2":1,"n3":1,"a":1,"b":1, // tri
					// "m1":4,"m2":4,"n1":2,"n2":2,"n3":2,"a":1,"b":1, // 			// circle
					// "m1":[[[4,8]]],"m2":[[[4,8]]],"n1":2,"n2":2,"n3":2,"a":1,"b":1,
					// "m1":4,"m2":4,"n1":100,"n2":100,"n3":100,"a":1,"b":1, // square
					"m1":4,"m2":4,"n1":2,"n2":2,"n3":2,"a":1,"b":1,// circle
					
					// "ra2": [[[30,260/  Math.sqrt(2),260/  Math.sqrt(2)]]],
					"ra2": [[[30,30,262/  Math.sqrt(2), 262/  Math.sqrt(2), 262/  Math.sqrt(2) , 262/  Math.sqrt(2), 262/  Math.sqrt(2) ]]],
					"ra2": 162,
					"v0": 0,"v1":1,
					"w4":  0, // [[[180,360,180]]], // [[[0,-360,0]]],
					"seg5": 360,"pa6":0,"pb7":-1,
					"fas8": 0,
				}
			} 

let state = {
			
				"x":  0,
				"y":  0,
				"z":  0,
				
			}
			
let graticule = {
	
				// "extent": [ [-180, 180, 90, 12],  [-180, 180, 360, 6] ],
			"extent": [ [-180, 180, [[[15,15]]], 45],  [-180, 180, 15, 15] ],

		}		

	let projection = 
				{
						"projection": "identity",
						"scale": 1,
						"translate": [ 300, 200 ],
						"rotate": [ [[[0, - 0 * 360]]], 0, 0 ],
				
						// "projection": "mercator",
						// "scale": 40,
						// "translate": [ 340, 200 ],
						// "rotate": [ [[[0, - 0 * 360]]], 0, 0 ],
						// "transform": function(x,y){
								// this.stream.point(x/1,y/1) 
						// },						

						// "projection": "orthographic",
						// "scale": 200,
						// "translate": [ 340, 200 ],
						// "rotate": [ [[[0, - 0 * 360]]], 0, 0 ],
						// "transform": function(x,y){
								// this.stream.point(x/2,y/2) 
						// },	
						
				}			
				
				
/*******************************************
 * @animas
 * 
 */	
 


// ------------------------------- 	img			
 let img = {
			"pic": {
				"tim": tim,
				"ric": {"gid":"img","cid":"img","fid":"img",},
				"halo":"img",
			
				"ture": { "csx":0,"cf":[[[22,22]]],"cs":22,"cw":[[[0.3,0.3]]],"co":[[[0.7,0.7,]]],"cp":[[[0.3,0.3]]],},
				"img": { 
					"iid":"zIMG_504.jpg",
					"a": 0,
					"b": 0,
					"width": 600,
					"height": 400,
					"rotate": [[[0,0]]],
					"scale": [ [[[1.6,1,1]]], [[[1.4,1,1]]] ],
					"translate": [0, 0],
				},
			}
	}
	
// ------------------------------- 	geotess	
let geotess = {
			"pic": {
				"tim": tim,
				"ric": {"gid":"geotess","cid":"geotess","fid":"geotess",},
				"halo":"geotess",

				"ture": { "csx":0,"cf":[[[111,111]]],"cs":666,"cw":0.7,"co":[[[0.05,0.05]]],"cp":[[[0.9,0.9]]],},
				
				"graticule": graticule,					
				"projection": {
						"projection": "identity",
						"scale": 1,
						"translate": [ 300, 200 ],
						"rotate": [ [[[0, - 0 * 360]]], 0, 0 ],		
				},
				
				"form": form,
				
				"state": {	
					"x": 300,
					"y": 200,
					"z": 200,
				},				
			},
		}

/*******************************************
 * @animaApi
 * 
 */

		let animas = [
			geotess			// geotess
		] 

		var animaApi = function animaApi() {
			
				for (let i=0; i < animas.length; i++) {
					let anima = animas[i]
					let newAnimas = __mapper("xs").m("store").ween(anima)
						__mapper("xs").m("store").apply({"type":"UPDANIMA","caller":"alima","animas":newAnimas})
					
				}
			
		}
	
	return animaApi

}

var __mapper = xMapper.xMapper()
var muonAlima = __mapper({'muonAlima': muonAlima(__mapper)}).muonAlima(__mapper)
</script>

