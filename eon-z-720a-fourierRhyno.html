<script src="eon-x-eonify.js"></script>
<script>
window.xEonify.eon({anitem, time: undefined})

// .................. anitem
async function anitem (__mapper) {
  // .................. eons
  let [
    mfourier,
    mproj3ct,
    mprofier,
    mgeoj,
    drhyno,
  ] = await Promise.all([
    __mapper('xs').m('fourier'),
    __mapper('xs').m('proj3ct'),
    __mapper('xs').m('profier'),
    __mapper('xs').m('geoj'),
    __mapper('xs').d('rhyno'),
  ])

  // .................. animas
  let ani = function () {
    // .................. pics
    let tim = {'td': 63800, 't0': 0, 't1': 1000, 't2': 1, 't3': 1}

    // md:   data from m.animas('shapes').rhyno unframed
    // md:   defined as (closed) LineString gemetry.coordinates
    // md:   mfourier.transformedCoefs(tfeature)
    let svgdata = JSON.parse(drhyno.data())
    let data = {
      type: 'Feature',
      geometry: {
        type: 'LineString',
        coordinates: svgdata,
      },
    }

    let proform = {
      projection: 'uniwen',
      translate: [ -100, 100 ],
      scale: [1, -1],
      rotate: [ 0, 0 ],
      lens: [0, 1, Infinity],
    }

    let geoData = mproj3ct(data, mprofier.uniweon(proform))

    let transforms = mfourier.transformedCoefs(geoData)
    transforms = mgeoj.ntime(transforms, [0, 1])
    let transformsFC = { type: 'FeatureCollection', features: transforms }

    // ............................. aniLine
    let aniLine = {

      halo: 'ent',
      payload: {
        geofold: {
          type: 'Feature',
          geometry: {
            type: 'LineString',
            coordinates: []},
          properties: {},
        },
        tim: tim,
        ric: {'gid': 'pol', 'cid': 'pol', 'fid': 'pol'},
        boform: {'csx': 0, 'cf': 555, 'cs': 777, 'cw': 0.99, 'co': 1, 'cp': 1},
      },

    }

    // ............................. traceline
    let traceline = { // SUB-MARKS line trace

      halo: 'pacer',
      payload: {
        geofold: null,

        pacer: { // aad for trace
          tim,
          ric: {gid: 'trace', cid: 'trace', fid: 'trace'},
          boform: {'csx': 0, 'cf': 444, 'cs': 666, 'cw': 0.99, 'co': 0.9, 'cp': 0.99},

          stace: {x: { pos: 0 }, y: { pos: 0 }, z: 0}, //
          initN: 0, eventN: 0, autoN: 1, autoP: 0, outtimed: 0, maxN: 60, span: 0, aad: 1,

          geojsor: function (ani, props) {
            let ric = ani.payload.pacer.ric // ric
            let uid = mric.getuid(ric)

            let gj = {
              halo: 'ent',
              payload: {
                geofold: {
                  type: 'Feature',
                  geometry: { type: 'LineString', coordinates: null },
                  properties: { doc: 'pacer' },
                },

                uid: uid, id: uid, ric: ric,
                geodrift: {
                  proform: this.proform,
                },
              },
            }
            let newItem = mstore.findAnigramFromUid(uid) || gj
            if (newItem.geofold.properties.formEreformed) {
              newItem.geofold.geometry = newItem.geofold.properties.formEreformed.geometry
            }

            return newItem
          },
        },
      },
    }

    // .................. fourierForm
    let fourierForm = {

      halo: 'fourier',

      payload: { // payload in fourierForm
        geofold: p => transformsFC,

        tim: tim,
        ric: { gid: 'fourier', cid: 'fourier', fid: 'fourier'},
        boform: {'csx': 0, 'cf': 555, 'cs': 999, 'cw': 0.095, 'co': 0.092, 'cp': 0.99},

        fourier: {
          transforms: transforms,
          interval: [0.0, 0.99],
          tolerance: 0.1, // 0.1
          dotboform: {'csx': 0, 'cf': 888, 'cs': 999, 'cw': 0.9, 'co': 0.01, 'cp': 0.7},

          //  fourier avatars are defined by name
          avatars: {
            traceline: traceline,
            rayline: aniLine,

          },
        },
      },
    }

    // .................. sceneAni
    let sceneAni = {

      halo: 'scene',
      payload: {
        geofold: null,
        tim: tim,
        ric: {gid: 'scene', cid: 'scene', fid: 'scene'},
        context: {svg: 1, versor: 0, wen: 1, webgl: 0, bck: 1},
      },

    }

    // .................. animas
    let animas = [

      fourierForm, // h.fourier
      sceneAni, // h.scene
    ]

    return animas
  }

  let enty = () => {}
  enty.ani = ani
  return enty
}
</script>